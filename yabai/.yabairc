#!/bin/bash

# Globals
yabai -m config layout stack
yabai -m config auto_balance on
yabai -m config split_type horizontal

yabai -m config window_origin_display cursor
yabai -m config window_placement first_child

yabai -m config mouse_follows_focus on
yabai -m config mouse_drop_action stack

# Rules
## Whitelist
yabai -m rule --add app!="^(Terminal|Zed|Safari|Google Chrome|Books|Xcode|Figma|Freeform|Activity Monitor)$" manage=off

## Set Default Display
yabai -m rule --add app=Figma display=^1
yabai -m rule --add app=Numbers display=^1
yabai -m rule --add app=Freeform display=^1
yabai -m rule --add app=Xcode display=^1
yabai -m rule --add app=Zed display=^1

## Fixed positions: grid=<rows>:<cols>:<start-x>:<start-y>:<width>:<height>

yabai -m rule --add app=Messages grid=10:8:3:1:2:6 display=^1
yabai -m rule --add app=Reminders grid=10:8:3:1:2:6 display=^1
yabai -m rule --add app=Contacts grid=10:8:3:1:2:6 display=^1

yabai -m rule --add app=WhatsApp grid=10:9:3:1:3:6 display=^1
yabai -m rule --add app=OrbStack grid=10:9:3:1:3:6 display=^1

yabai -m rule --add app=Finder grid=1:9:3:1:3:1 display=^1
yabai -m rule --add app="^System Settings$" grid=1:9:3:1:3:1 display=^1

yabai -m rule --add app=Notes title!=Notes grid=1:9:3:1:3:1 display=^1

yabai -m rule --add app=Zed title="^(Open|Save)$" grid=10:9:3:1:3:6 manage=off

# Signals
## Fix for focus on window creation
yabai -m signal --add event=window_created app=Messages action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Messages\") | .id") --focus'
yabai -m signal --add event=window_created app=Reminders action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Reminders\") | .id") --focus'
yabai -m signal --add event=window_created app=OrbStack action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"OrbStack\") | .id") --focus'
yabai -m signal --add event=window_created app=Figma action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Figma\") | .id") --focus'
