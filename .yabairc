#!/bin/bash

yabai -m config layout bsp

yabai -m config auto_balance on

# Mouse support
yabai -m config focus_follows_mouse off
yabai -m config mouse_follows_focus on

# Window modification
yabai -m config window_shadow float

# Padding and gaps
yabai -m config top_padding 2
yabai -m config bottom_padding 2
yabai -m config left_padding 2
yabai -m config right_padding 2
yabai -m config window_gap 2

yabai -m config window_origin_display focused

# Rules

## Whitelist
yabai -m rule --add app!="^(Terminal|Zed|Finder|Safari|Google Chrome|Notes|MongoDB Compass|Books|Xcode|Figma|Freeform)$" manage=off

## Fixed positions
yabai -m rule --add app=Messages grid=24:6:1:0:4:10 display=2
yabai -m rule --add app=WhatsApp grid=24:10:1:11:8:12 display=2
yabai -m rule --add app=Twitter title=Twitter grid=10:10:2:1:6:4 display=3
yabai -m rule --add app=Things display=2

# Signals
yabai -m config split_type vertical

## Custom split
yabai -m signal --add event=window_created app!="^(Things|Messages|Twitter|WhatsApp)$" action='if [[ $(yabai -m query --displays --display | jq -r ".frame.w" | cut -d "." -f 1) -eq 1080 ]] && [[ $(yabai -m query --windows --window | jq -r ".[\"split-type\"]") == "none" || $(yabai -m query --windows --window | jq -r ".[\"split-type\"]") == "vertical" ]]; then yabai -m window --toggle split; fi'

# Fixes open on fullscreen
yabai -m signal --add event=window_created app=Things action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Things\") | .id") --toggle native-fullscreen'

## Fixes for focus on window creation
yabai -m signal --add event=window_created app=Messages action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Messages\") | .id") --focus'
yabai -m signal --add event=window_created app=Twitter action='yabai -m window $(yabai -m query --windows | jq  ".[] | select(.app==\"Twitter\") | .id") --focus'
